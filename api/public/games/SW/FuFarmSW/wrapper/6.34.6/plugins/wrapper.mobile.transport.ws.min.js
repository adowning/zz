(window.webpackJsonp1588865924768=window.webpackJsonp1588865924768||[]).push([[35],{114:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));const n=["init","reinit","transfer-in","transfer-out","jp-ticker","balance","choose-game","state","redeem-bns","get-games","player-action","keep-alive"],i=e=>n.includes(e)},235:function(e,t,s){"use strict";s.r(t);var n=s(83),i=s(0),o=s(7);var r=s(9),c=s(221),a=s(8),h=s(1);const u=["connect","connecting","disconnect","reinit-claim"],d=e=>Object(h.i)(e,{sw_ts:""+Date.now()}),k=({name:e})=>{a.a.emit("ANALYTICS_PARAMS_CHANGED",{serverProtocol:"WebSocket:"+e})};class m extends r.EventEmitter{constructor(e,t){super(),this.socket=c(d(e),t),this.addListeners()}static create(e,t){return new m(e,t).ready()}ready(){return new Promise((e,t)=>{const s=()=>{this.off("connect_error",n),k(this.socket.io.engine.transport),e(this)},n=e=>{this.off("connect",s),t()};this.once("connect",s).once("connect_error",n)})}send(e,t){this.socket.emit(e,t)}destroy(){this.removeAllListeners(),this.socket.removeAllListeners(),this.socket.close()}on(e,t,s){return super.on(e,t,s),this.bindEvent(e),this}once(e,t,s){return super.once(e,t,s),this.bindEvent(e),this}bindEvent(e){const t=u.includes(e)?1:0;this.socket.listeners(e).length<=t&&this.socket.on(e,t=>this.emit(e,t))}async reconnect(){this.disconnected||this.socket.disconnect(),await Object(o.b)(1e3),this.socket.connect(),await this.ready()}disconnect(){this.socket.disconnect()}addListeners(){this.socket.io.on("open",()=>this.setTokenSearchParameter()),this.socket.io.engine.on("upgrade",k),this.socket.on("disconnect",()=>this.updateTimestamp())}setTokenSearchParameter(){var e;const t=Object(h.c)("startGameToken"),{engine:s}=null===(e=this.socket)||void 0===e?void 0:e.io;t&&s&&s.upgrade&&"open"===s.readyState&&(s.query=Object.assign(Object.assign({},s.query||{}),{startGameToken:t}))}updateTimestamp(){this.socket.io.uri=d(this.socket.io.uri)}get disconnected(){return this.socket.disconnected}}var p=s(13),l=s(102),E=s(114);s.d(t,"TransportWebSocket",(function(){return v}));class v{constructor(e){this.serverUrl=e,this.server=Object(i.d)(n.a),this.wrapperModel=Object(i.d)(p.a),this.dispatcher=Object(i.d)(a.a),this.errorMapping=Object(i.d)(l.a),this.requestTimeout=this.wrapperModel.liveGame?5e3:2e4,this._requestCount=0}get socket(){return this._socket}set requestCount(e){this._requestCount=e,this._requestCount||this.dispatcher.emit("REQUESTS_COMPLETED_EVENT")}get requestCount(){return this._requestCount}async init(e={}){return this.socket||(this.requestTimeout=e.requestTimeout||this.requestTimeout,this._socket=await m.create(this.serverUrl,e),this.addListeners(),this.dispatcher.emit("TRANSPORT_INITIALIZED",1)),this.socket}async serverRequest(e,t={}){const{request:s}=e;return t.wsEvent=t.requestName||(Object(E.a)(s)?s:"play"),"reinit"===t.wsEvent&&await this.reconnect(),new Promise(async(s,n)=>{setTimeout(n,this.requestTimeout),this.webSocketCall(s,n,e,t)})}async reconnect(){this.socket.off("disconnect",this.onDisconnect),await this._socket.reconnect(),this.socket.on("disconnect",this.onDisconnect,this)}webSocketCall(e,t,s,{wsEvent:n}){const{socket:i}=this,o=t=>{i.off("game-error",r),this.requestCount--,e(t)},r=e=>{i.off(n,o),this.requestCount--,t(e)};this.requestCount++,i.once(n,o).once("game-error",r).send(n,s)}addListeners(){this.socket.on("connect_timeout",this.handleConnectionError,this).on("connect_error",this.handleConnectionError,this).on("disconnect",this.onDisconnect,this).on("game-error",this.handleGameError,this).on("reinit-claim",this.onReinit,this)}onDisconnect(e){"io server disconnect"!==e&&this.server.performReInit()}handleGameError({code:e}){this.errorMapping.isSessionExpiredError(e)&&this.socket.destroy()}async onReinit(){await this.checkUncompletedRequests(),this._socket.disconnect()}checkUncompletedRequests(){return 0===this.requestCount?Promise.resolve():this.dispatcher.promisifiedOnce("REQUESTS_COMPLETED_EVENT")}handleConnectionError(){this.socket.destroy()}}}}]);