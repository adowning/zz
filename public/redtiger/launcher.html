<!DOCTYPE html>
<html style="background: black" translate="no" class="notranslate">

<head>
  <title>...</title>

  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />

  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="google" content="notranslate" />
  <meta name="format-detection" content="telephone=no" />

  <!-- FavIcons -->
  <link rel="apple-touch-icon" sizes="180x180"
    href="https://cdn-eu.cloudedge.info/all/games/slots/AncientDisco/assets/default/page/favicons/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32"
    href="https://cdn-eu.cloudedge.info/all/games/slots/AncientDisco/assets/default/page/favicons/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16"
    href="https://cdn-eu.cloudedge.info/all/games/slots/AncientDisco/assets/default/page/favicons/favicon-16x16.png" />
  <link rel="mask-icon"
    href="https://cdn-eu.cloudedge.info/all/games/slots/AncientDisco/assets/default/page/favicons/safari-pinned-tab.svg"
    color="#5bbad5" />
  <link rel="shortcut icon"
    href="https://cdn-eu.cloudedge.info/all/games/slots/AncientDisco/assets/default/page/favicons/favicon.ico" />
  <meta name="theme-color" content="#ffffff" />
</head>

<body>
  <img class="loading-icon" style="position: absolute; top: 0; bottom: 0; left: 0; right: 0; margin: auto"
    src="https://cdn-eu.cloudedge.info/all/games/slots/AncientDisco/../../../assets/loading.svg">
  <script>
    let params = new URLSearchParams(document.location.search);
let gameName = params.get("gameName"); // is the string "Jonathan"
      const LOADER_STATE = {
      token: null,
      gameSessionId: null,
      userId: null,
      config: {},
      gameName
    };
    // Register SW early so it controls fetch/XHR within this directory scope
    (function registerSW() {
      if (!('serviceWorker' in navigator)) return;
      try {
        const scope = location.pathname.replace(/[^/]+$/, ''); // current directory as scope
        // Only register for /games/redtiger/ path
          console.log('adding sw')
        
        if (!/\/games\/redtiger\/$/i.test(scope)) {
          // If the URL does not end with /games/redtiger/, compute directory anyway
        }
        navigator.serviceWorker.register('./sw.js', { scope })
          .then(reg => {
            // Optional: Immediately claim clients on update
            if (reg && reg.active) {
              // nop
            }
          })
          .catch(err => console.warn('[Loader] SW register failed', err));
      } catch (e) {
        // ignore
      }
    })();
  </script>
  <script type="text/javascript">
    // 1) Notify parent we are ready to receive config and tokens
    (function notifyReady() {
      try { window.parent && window.parent.postMessage('RTG_LOADER_READY', '*'); } catch (e) { }
    })();

    // 2) Maintain auth/config received from parent via postMessage
  (function() {
    const originalOpen = XMLHttpRequest.prototype.open;
    var originalSend = XMLHttpRequest.prototype.send;
    let aurl = ''
    window.aurl =''
        XMLHttpRequest.prototype.open = function(method, url) {
        this._requestUrl = url; // Store the URL in a custom property
        if(url.includes('game/settings') || url.includes('game/spin')){
        console.log('adda', url)
        window.aurl= url
        }else{
          window.aurl = ''
        }
        // this.setRequestHeader('Authorization', `Bearer ${LOADER_STATE.token}`);
// xhr.setRequestHeader('Authorization', `Bearer ${LOADER_STATE.token}`);
        return originalOpen.apply(this, arguments);
    };

    XMLHttpRequest.prototype.send = function(data, ) {
        // Modify headers before sending
        console.log('adda ', data)
        if(window.aurl.includes('game/settings') || window.aurl.includes('game/spin')){
        console.log('adda', window.aurl)
        this.setRequestHeader('Authorization', `Bearer ${LOADER_STATE.token}`);
        
      }
        originalSend.apply(this, arguments);
    };
})();

    // 3) Always include Authorization and credentials on fetch
  //   (function patchFetch() {
  //     if (!window.fetch) return;
  //     const originalFetch = window.fetch.bind(window);
  //     window.fetch = async function patchedFetch(input, init = {}) {
  //       try {
  //         const headers = new Headers((init && init.headers) || {});
  //         if (LOADER_STATE.token && !headers.has('Authorization')) {
  //           headers.set('Authorization', `Bearer ${LOADER_STATE.token}`);
  //         }
  //        console.log('adda ', input)
  //         if(input.includes('game/settings') || input.includes('game/spin')){
  //           headers.set('Authorization', `Bearer ${LOADER_STATE.token}`);
  //            const finalInit = {
  //           credentials: 'include',
  //           mode: 'cors',
  //           ...init,
  //           headers,
  //         };
  //                  console.log('adda ', finalInit)
  //                  console.log('adda ', headers.get('Authorization'))
  // return originalFetch(input, finalInit);
  //         }else{
  //         return originalFetch(input, init);

  //         }
  //       } catch (err) {
  //         console.error('[Loader] fetch patch error', err);
  //         return originalFetch(input, init);
  //       }
  //     };
  //   })();

    // 4) If axios is used by embedded game code, ensure withCredentials and Authorization
    // (function patchAxios() {
    //   try {
    //     if (window.axios) {
    //       console.log('addb')

    //       window.axios.defaults.withCredentials = true;
    //       window.axios.interceptors.request.use((config) => {
    //         if (!config.headers) config.headers = {};
    //         if (LOADER_STATE.token && !config.headers['Authorization']) {
    //           config.headers['Authorization'] = `Bearer ${LOADER_STATE.token}`;
    //         }
    //         config.withCredentials = true;
    //         return config;
    //       });
    //     }
    //   } catch (e) { }
    // })();
    // const OriginalXMLHttpRequest = window.XMLHttpRequest;
    // window.XMLHttpRequest = function () {
    //   const xhr = new OriginalXMLHttpRequest();
    //   const headers = new Headers((init && init.headers) || {});
    //   //  xhr.setRequestHeader((init && init.headers) || {});

    //   if (LOADER_STATE.token && !headers.has('Authorization')) {
    //     headers.set('Authorization', `Bearer ${LOADER_STATE.token}`);
    //   }
    //   const finalInit = {
    //     credentials: 'include',
    //     mode: 'cors',
    //     ...init,
    //     headers,
    //   };
    //   xhr.setRequestHeader(finalInit)

    //   //  xhr.open = function(method, url, async, user, password) {
    //   // console.log(`Intercepted request: ${method} ${url}`);

    //   // return originalOpen.apply(this, arguments);
    // };
    // Patch methods on the xhr instance
    // For example, patching the 'open' method:
    // const originalOpen = xhr.open;
    // xhr.open = function(method, url, async, user, password) {
    //     console.log(`Intercepted request: ${method} ${url}`);
    //     return originalOpen.apply(this, arguments);
    // };

    // // Patch other methods like 'send', 'setRequestHeader', 'onreadystatechange' as needed

    // return xhr;
    // };
    // 5) Receive INIT_GAME and SET_AUTH_TOKEN from parent
    window.addEventListener('message', (event) => {
      const data = (typeof event.data === 'string') ? safeParse(event.data) : event.data;
      if (!data) return;
      if (data.type === 'INIT_GAME' && data.config) {
        LOADER_STATE.config = { ...data.config };
        if (!LOADER_STATE.token && data.config.authToken) {
          LOADER_STATE.token = data.config.authToken;
        }
        if (data.config.gameSessionId) LOADER_STATE.gameSessionId = data.config.gameSessionId;
        if (data.config.userId) LOADER_STATE.userId = data.config.userId;
        console.log('[Loader] INIT_GAME received', { hasToken: !!LOADER_STATE.token });
      }
      if (data.type === 'SET_AUTH_TOKEN') {
      LOADER_STATE.gameName = data.gameName;

        LOADER_STATE.token = data.token || LOADER_STATE.token;
        LOADER_STATE.gameSessionId = data.gameSessionId || LOADER_STATE.gameSessionId;
        LOADER_STATE.userId = data.userId || LOADER_STATE.userId;
        console.log('[Loader] SET_AUTH_TOKEN received', { hasToken: !!LOADER_STATE.token });
       
         if (com.casino.bridge && typeof com.casino.bridge.init === 'function') {
        com.casino.bridge.init(com.casino.preconfig);
            const loadingIcon = document.querySelector('.loading-icon');
            if (loadingIcon) loadingIcon.style.display = 'none';

            // SUCCESS: Notify parent frame that the game is fully loaded.
            window.parent.postMessage({ type: 'clientReady' }, '*');
          } else {
            // throw new Error('com.casino.bridge.init is not available!');
            console.log('com.casino.bridge.init is not available!')
          }
      }
    });

    function safeParse(str) { try { return JSON.parse(str); } catch { return null; } }
  </script>
  <script id="bridgeScript" type="text/javascript" crossorigin=""></script>

  <script type="text/javascript">
        const urlParams = new URLSearchParams(window.location.search);
LOADER_STATE.gameName = urlParams.get('gameName');
    window.com = window.com || {};
    window.com.casino = window.com.casino || {};
    com.casino.cdn = `https://cdn-eu.cloudedge.info/all/games/slots/${LOADER_STATE.gameName}/`;
    com.casino.baseCdn = `https://cdn-eu.cloudedge.info/all/games/`;
    com.casino.barsPath = `https://cdn-eu.cloudedge.info/all/games/slots/${LOADER_STATE.gameName}/../../bars-next/`;
    com.casino.bridgePath = `https://cdn-eu.cloudedge.info/all/games/slots/${LOADER_STATE.gameName}/../../bridge/`;
  </script>

  <!-- Import Bridge -->
  <!-- <script type="text/javascript" crossorigin="" src="https://cdn-eu.cloudedge.info/all/games/slots/AncientDisco/../../bridge/bridge.min.js?t=1739871063115"></script> -->
  <script id="bridgeScript" type="text/javascript" crossorigin=""></script>



  <!-- launcher -->

  <script type="text/javascript">
    (function () {
      'use strict';
       var  isBridgeScriptLoaded = false;
       var  isAuthTokenReceived = false;
      const bridgeScriptElement = document.getElementById('bridgeScript');
      if (bridgeScriptElement) {
        // --- LOAD SCRIPT FROM THE LOCAL PATH ---
        bridgeScriptElement.src = `/games/redtiger/rtg.bridge.js?t=${new Date().getTime()}`;
        bridgeScriptElement.onload = function () {
          isBridgeScriptLoaded = true;
          tryInitializeBridge();
        };
        bridgeScriptElement.onerror = function () {
          console.error('[RTG Loader] Failed to load bridge script.');
          window.parent.postMessage({ type: 'game_error', data: { error: 'Failed to load bridge script.' } }, '*');
        };
        com.casino.bridge = bridgeScriptElement
      } else {
        throw new Error('Bridge script element not found in template.');
      }

      // window.addEventListener('message', (event) => {
      //   const data = (typeof event.data === 'string') ? safeParse(event.data) : event.data;
      //   if (!data) return;

      //   if (data.type === 'INIT_GAME' && data.config) {
      //     LOADER_STATE.config = { ...data.config };
      //     if (!LOADER_STATE.token && data.config.authToken) {
      //       LOADER_STATE.token = data.config.authToken;
      //     }
      //     if (data.config.gameSessionId) LOADER_STATE.gameSessionId = data.config.gameSessionId;
      //     if (data.config.userId) LOADER_STATE.userId = data.config.userId;
      //     console.log('[Loader] INIT_GAME received', { hasToken: !!LOADER_STATE.token });
      //   }
      //   if (data.type === 'SET_AUTH_TOKEN') {
      //     LOADER_STATE.token = data.token || LOADER_STATE.token;
      //     LOADER_STATE.gameSessionId = data.gameSessionId || LOADER_STATE.gameSessionId;
      //     LOADER_STATE.userId = data.userId || LOADER_STATE.userId;
      //     console.log('[Loader] SET_AUTH_TOKEN received', { hasToken: !!LOADER_STATE.token });
      //   }
      // });
      // if (com.casino.debug) 
      // com.casino.debug.onlyGaff = true;

   const urlParams = new URLSearchParams(window.location.search);
LOADER_STATE.gameName = urlParams.get('gameName');
console.log(LOADER_STATE.gameName)
      com.casino.preconfig = {
        bridge: {
          postParams: [],
          feedUrl: 'https://feed-rtg.redtiger.com/',
          provider: 'kronos',
          operator: 'redtiger',
          timestamp: '?t=1739871063115',
          notifications: {
            inRealPlay: true,
            inDemoPlay: false,
            showUnfinishedWins: true,
            showUnfinishedNoWins: false
          },
          bridgeLaunch: true
        },
        server: {
          rgsApi: `https://api.cashflowcasino.com/api/redtiger/`,
          launchParams: {
            gameId:  LOADER_STATE.gameName,
          }
        },
        game: {
          namespace: 'com.casino.game',
          preconfig: {
            cdn: `https://cdn-eu.cloudedge.info/all/games/slots/${LOADER_STATE.gameName}/`,
            delayedBalanceUpdate: false,
            defaultLang: 'en',
            splash: true,
            hideCurrency: true,
            disclaimer: '',
            skin: 'next-name-payouts',
            skinURL: '',//get['skinURL'],
            gameType: 'slot',
            gameAppId: LOADER_STATE.gameName,
            responsive: true,
            addedAnticipation: false
          }
        },
        bars: {
          basePath: `https://cdn-eu.cloudedge.info/all/games/slots/${LOADER_STATE.gameName}/../../bars-next/`,
          options: {
            historySrc: `https://cdn-eu.cloudedge.info/all/games/slots/${LOADER_STATE.gameName}/../../history/`,
            hasGamble: true
          }
        },
        bonusWheel: {
          cdn: `https://cdn-eu.cloudedge.info/all/games/slots/${LOADER_STATE.gameName}/`,
          basePath: '../../scenes/bonus-wheels/{skin}/',
          skin: 'base-wheel',
          enabled: true,
        },
        analytics: {
          gaTrackingIds: ["G-5YV4BNS2LW"]
        }
      };
      function tryInitializeBridge() {
        if (isAuthTokenReceived && isBridgeScriptLoaded) {
          console.log('[RTG Loader] Initializing bridge...');
          localPreconfig.bridge.token = authToken;
          localPreconfig.bridge.userId = authUserId;
          const rgsApiBasePath = gameConfig.rgsApiBase + `/${gameSessionId}` || `/rpc/spin-data/${localPreconfig.bridge.operator}/platform`;
          localPreconfig.server.rgsApi = `${rgsApiBasePath}/${authToken}/${localPreconfig.server.launchParams.gameId}/`;
          casino.preconfig = localPreconfig;
          com.casino.preconfig.server.launchParams.gameId = LOADER_STATE.gameName;
          com.casino.preconfig.game.preconfig.gameAppId = LOADER_STATE.gameName;

          if (casino.bridge && typeof casino.bridge.init === 'function') {
          
            casino.bridge.init(com.casino.preconfig);

            const loadingIcon = document.querySelector('.loading-icon');
            if (loadingIcon) loadingIcon.style.display = 'none';

            // SUCCESS: Notify parent frame that the game is fully loaded.
            window.parent.postMessage({ type: 'clientReady' }, '*');
          } else {
            throw new Error('com.casino.bridge.init is not available!');
          }
        }
      }
      // com.casino.bridge.init(com.casino.preconfig);

    })();

  </script>

  <!-- <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9144be6178fd6bf2',t:'MTczOTk1MjI0MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script><script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"rayId":"9144be6178fd6bf2","serverTiming":{"name":{"cfExtPri":true,"cfL4":true,"cfSpeedBrain":true,"cfCacheStatus":true}},"version":"2025.1.0","token":"5bfdcc21faef425283d990b37461fcae"}' crossorigin="anonymous"></script> -->
</body>

</html>